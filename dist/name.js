!function(e,a){"use strict";const o=e.initializeApp({apiKey:"AIzaSyDs8wTtgLSOg-bnLpBK4K5Hege66pg9wVQ",authDomain:"streamixmovie.firebaseapp.com",projectId:"streamixmovie",storageBucket:"streamixmovie.appspot.com",messagingSenderId:"724237092696",appId:"1:724237092696:web:7e2f773517853bb6b5872d"}),t=a.getFirestore(o);var r={Avatares:[{id:1,nombre:"Avatar 1",ruta:"../../ImagenesAvatares/Screenshot_1-topaz-enhance-4x.webp"},{id:2,nombre:"Avatar 2",ruta:"../../ImagenesAvatares/avatar2.webp"}]};document.addEventListener("DOMContentLoaded",(async function(){const e=JSON.parse(localStorage.getItem("usuario"));if(console.log("Usuario recuperado desde localStorage:",e),!e||!e.usuarioId)return void console.error("Datos del usuario no encontrados en localStorage");const o=await async function(e){try{const o=a.doc(t,"usuarios",e),r=await a.getDoc(o);if(r.exists()){const a=r.data(),o={...JSON.parse(localStorage.getItem("usuario"))||{},correo:a.correo,"contraseña":a.contraseña,usuarioId:e,nombre:a.nombreUsuario,avatarId:a.avatarId};return localStorage.setItem("usuario",JSON.stringify(o)),console.log("Datos del usuario actualizados en localStorageeee:",o),o}return console.error("El usuario no existe en la base de datos."),null}catch(e){return console.error("Error al obtener datos del usuario:",e),null}}(e.usuarioId);console.log("Datos actualizados obtenidos:",o),function(e){if(!e)return;const a=document.querySelector(".profile-name");a?(a.textContent=e.nombreUsuario,console.log("Nombre de usuario asignado al elemento .profile-name:",e.nombreUsuario)):console.error("No se encontró el elemento .profile-name");const o=document.getElementById("avatarImg");if(o&&e.avatarId){const a=function(e){const a=r.Avatares.find((a=>a.id===e));return console.log("Ruta del avatar buscada para el ID",e,":",a?a.ruta:"No encontrado"),a?a.ruta:null}(parseInt(e.avatarId,10));a?(o.src=a,o.dataset.avatarId=e.avatarId,console.log("Ruta del avatar obtenida:",a)):console.error("Ruta del avatar no encontrada para el ID:",e.avatarId)}else console.error("No se encontró el elemento de avatar o el campo avatarId está vacío")}(o),function(){const e=document.getElementById("saveNameButton"),o=document.querySelector(".inputnamenew"),r=document.getElementById("savenewname"),n=document.querySelector(".profiledatenew"),s=document.querySelector(".profile_img");e&&o&&r?e.addEventListener("click",(function(){console.log('Botón "Administrar perfiles" clickeado'),n.classList.toggle("active"),setTimeout((()=>{o.classList.toggle("active"),r.classList.toggle("active");const e=document.querySelector(".profile-name").textContent;o.value=e,console.log("Campo de edición mostrado con valor:",o.value)}),40)})):console.error("No se encontraron los elementos necesarios para editar el nombre");r?r.addEventListener("click",(async function(){try{const e=o.value.trim();if(console.log("Nuevo nombre ingresado:",e),e&&""!==e){const s=JSON.parse(localStorage.getItem("usuario")),c=document.getElementById("avatarImg").dataset.avatarId,l=await async function(e,o,r){try{const n=a.doc(t,"usuarios",e);await a.updateDoc(n,{nombreUsuario:o,avatarId:parseInt(r,10)});const s=JSON.parse(localStorage.getItem("usuario"));return s&&(s.nombre=o,s.avatarId=parseInt(r,10),localStorage.setItem("usuario",JSON.stringify(s))),console.log("Nombre y avatar del usuario actualizados correctamente."),{success:!0}}catch(e){return console.error("Error al actualizar el nombre y avatar del usuario:",e),{success:!1,reason:"Error al actualizar el nombre y avatar del usuario",details:e.message}}}(s.usuarioId,e,parseInt(c,10));l.success?(s.nombre=e,localStorage.setItem("usuario",JSON.stringify(s)),document.querySelector(".profile-name").textContent=e,o.classList.remove("active"),r.classList.remove("active"),setTimeout((()=>{n.classList.remove("active"),console.log("Nombre actualizado y campo de edición oculto")}),250)):alert(`Error: ${l.reason}`)}else alert("El nombre no puede estar vacío")}catch(e){console.error('Error en el evento del botón "Guardar":',e),alert("Ocurrió un error al intentar guardar el nuevo nombre")}})):console.error("No se encontró el botón de guardar");s&&s.addEventListener("click",(()=>{localStorage.getItem("usuario")?window.location.href="index.html":window.location.href="login.html"}))}()}))}(app,lite);
